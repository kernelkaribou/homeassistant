server {
    listen 80 default_server;

    include /etc/nginx/includes/server.conf;

	location %%ingress_entry%% {
		proxy_read_timeout 360s;
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "upgrade";

		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Forwarded-Proto $scheme;

		rewrite %%ingress_entry%%/(.*) /$1  break;

		proxy_pass http://beszel;
	
        # Additional headers for proper ingress handling
        proxy_set_header X-Ingress-Path "%%ingress_entry%%";
    }

    # ## OLD
    #     location / {

    #     include /etc/nginx/includes/proxy.conf;

    #     proxy_pass http://beszel%%ingress_entry%%/;
        
    #     # Additional headers for proper ingress handling
    #     proxy_set_header X-Ingress-Path "%%ingress_entry%%";
    # }
}